<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StockSight - Inventory Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .sidebar {
        transition: all 0.3s ease;
      }
      .product-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
      .status-in-stock {
        background-color: #10b981;
      }
      .status-low {
        background-color: #f59e0b;
      }
      .status-out {
        background-color: #ef4444;
      }
      .notification {
        animation: slideIn 0.5s forwards, fadeOut 0.5s 3s forwards;
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
        }
        to {
          transform: translateX(0);
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }
      .chart-container {
        position: relative;
        height: 300px;
      }
      .chart-legend {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }
      .legend-item {
        display: flex;
        align-items: center;
        margin-right: 20px;
        margin-bottom: 10px;
        cursor: pointer;
      }
      .legend-color {
        width: 20px;
        height: 20px;
        margin-right: 5px;
        border-radius: 3px;
      }
      .legend-text {
        font-size: 14px;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Header/Navigation -->
    <header class="bg-indigo-600 text-white shadow-md">
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <div class="flex items-center space-x-4">
          <button
            id="mobile-menu-button"
            class="md:hidden text-white focus:outline-none"
          >
            <i class="fas fa-bars text-xl"></i>
          </button>
          <div class="flex items-center">
            <i class="fas fa-boxes text-2xl mr-2"></i>
            <h1 class="text-2xl font-bold">StockSight</h1>
          </div>
        </div>

        <nav class="hidden md:flex space-x-6">
          <a href="#" class="nav-link active" data-page="dashboard"
            >Dashboard</a
          >
          <a href="#" class="nav-link" data-page="products">Products</a>
          <a href="#" class="nav-link" data-page="reports">Reports</a>
        </nav>

        <div class="flex items-center space-x-4">
          <div class="relative">
            <button id="notification-btn" class="text-white focus:outline-none">
              <i class="fas fa-bell text-xl"></i>
              <span
                id="notification-badge"
                class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden"
                >0</span
              >
            </button>
          </div>
          <div class="relative">
            <button
              id="profile-btn"
              class="flex items-center space-x-2 focus:outline-none"
            >
              <div
                class="w-8 h-8 rounded-full bg-indigo-400 flex items-center justify-center"
              >
                <i class="fas fa-user text-white"></i>
              </div>
              <span class="hidden md:inline">Admin</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Mobile Sidebar -->
    <div
      id="mobile-sidebar"
      class="sidebar fixed inset-y-0 left-0 w-64 bg-indigo-700 text-white transform -translate-x-full z-50 md:hidden"
    >
      <div class="p-4">
        <div class="flex items-center space-x-2 mb-8">
          <i class="fas fa-boxes text-2xl"></i>
          <h2 class="text-xl font-bold">StockSight</h2>
        </div>
        <nav class="flex flex-col space-y-4">
          <a href="#" class="nav-link-mobile active" data-page="dashboard">
            <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
          </a>
          <a href="#" class="nav-link-mobile" data-page="products">
            <i class="fas fa-boxes mr-3"></i> Products
          </a>
          <a href="#" class="nav-link-mobile" data-page="reports">
            <i class="fas fa-chart-bar mr-3"></i> Reports
          </a>
        </nav>
      </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
      <!-- Dashboard Page -->
      <div id="dashboard-page" class="page-content">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
          Dashboard Overview
        </h2>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500">Total Products</p>
                <h3
                  id="total-products"
                  class="text-3xl font-bold text-gray-800"
                >
                  0
                </h3>
              </div>
              <div class="bg-indigo-100 p-3 rounded-full">
                <i class="fas fa-boxes text-indigo-600 text-xl"></i>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500">Low Stock Alerts</p>
                <h3
                  id="low-stock-count"
                  class="text-3xl font-bold text-gray-800"
                >
                  0
                </h3>
              </div>
              <div class="bg-red-100 p-3 rounded-full">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-500">Total Inventory Value</p>
                <h3 id="total-value" class="text-3xl font-bold text-gray-800">
                  $0
                </h3>
              </div>
              <div class="bg-green-100 p-3 rounded-full">
                <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-800">
              Inventory Overview
            </h3>
            <div class="flex space-x-2">
              <select
                id="chart-type"
                class="text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500"
              >
                <option value="bar">Bar Chart</option>
                <option value="pie">Pie Chart</option>
                <option value="line">Line Chart</option>
              </select>
              <select
                id="chart-sort"
                class="text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500"
              >
                <option value="name">Sort by Name</option>
                <option value="quantity">Sort by Quantity</option>
                <option value="value">Sort by Value</option>
              </select>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="inventory-chart"></canvas>
          </div>
          <div id="chart-legend" class="chart-legend"></div>
        </div>

        <!-- Top Selling Products -->
        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">
            Top Selling Products
          </h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Product
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Category
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Sales
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Revenue
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Stock
                  </th>
                </tr>
              </thead>
              <tbody
                id="top-products-body"
                class="bg-white divide-y divide-gray-200"
              >
                <!-- Filled by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Products Page -->
      <div id="products-page" class="page-content hidden">
        <div
          class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6"
        >
          <h2 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">
            Product Inventory
          </h2>
          <div
            class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 w-full md:w-auto"
          >
            <div class="relative">
              <select
                id="category-filter"
                class="block appearance-none bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:border-indigo-500 w-full"
              >
                <option value="">All Categories</option>
                <option value="Electronics">Electronics</option>
                <option value="Clothing">Clothing</option>
                <option value="Home & Garden">Home & Garden</option>
                <option value="Food & Beverage">Food & Beverage</option>
                <option value="Books">Books</option>
              </select>
              <div
                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"
              >
                <i class="fas fa-chevron-down"></i>
              </div>
            </div>
            <div class="relative">
              <input
                id="search-products"
                type="text"
                placeholder="Search products..."
                class="block w-full bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded leading-tight focus:outline-none focus:border-indigo-500"
              />
              <div
                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"
              >
                <i class="fas fa-search"></i>
              </div>
            </div>
            <button
              id="add-product-btn"
              class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded flex items-center justify-center"
            >
              <i class="fas fa-plus mr-2"></i> Add Product
            </button>
          </div>
        </div>

        <!-- Products Table (Desktop) -->
        <div class="hidden md:block bg-white rounded-lg shadow overflow-hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Image
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Product Name
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Category
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Quantity
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Price
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Status
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody
                id="products-table-body"
                class="bg-white divide-y divide-gray-200"
              >
                <!-- Filled by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Products Cards (Mobile) -->
        <div id="products-cards" class="grid grid-cols-1 gap-4 md:hidden">
          <!-- Filled by JavaScript -->
        </div>

        <!-- No Products Message -->
        <div
          id="no-products-message"
          class="bg-white rounded-lg shadow p-8 text-center hidden"
        >
          <i class="fas fa-box-open text-4xl text-gray-400 mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">
            No Products Found
          </h3>
          <p class="text-gray-500 mb-4">
            Add your first product to get started
          </p>
          <button
            id="add-first-product-btn"
            class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-6 rounded"
          >
            <i class="fas fa-plus mr-2"></i> Add Product
          </button>
        </div>
      </div>

      <!-- Reports Page -->
      <div id="reports-page" class="page-content hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Inventory Reports</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              Stock Status
            </h3>
            <canvas id="stock-status-chart" height="250"></canvas>
          </div>

          <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              Category Distribution
            </h3>
            <canvas id="category-distribution-chart" height="250"></canvas>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">
            Inventory Value by Category
          </h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Category
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Product Count
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Total Quantity
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Total Value
                  </th>
                </tr>
              </thead>
              <tbody
                id="category-report-body"
                class="bg-white divide-y divide-gray-200"
              >
                <!-- Filled by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <!-- Add/Edit Product Modal -->
    <div
      id="product-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center border-b px-6 py-4">
          <h3 id="modal-title" class="text-xl font-semibold text-gray-800">
            Add New Product
          </h3>
          <button id="close-modal" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="product-form" class="p-6">
          <input type="hidden" id="product-id" />
          <div class="mb-4">
            <label
              for="product-name"
              class="block text-gray-700 text-sm font-medium mb-2"
              >Product Name *</label
            >
            <input
              type="text"
              id="product-name"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              required
            />
          </div>
          <div class="mb-4">
            <label
              for="product-category"
              class="block text-gray-700 text-sm font-medium mb-2"
              >Category *</label
            >
            <select
              id="product-category"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              required
            >
              <option value="">Select a category</option>
              <option value="Electronics">Electronics</option>
              <option value="Clothing">Clothing</option>
              <option value="Home & Garden">Home & Garden</option>
              <option value="Food & Beverage">Food & Beverage</option>
              <option value="Books">Books</option>
            </select>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label
                for="product-quantity"
                class="block text-gray-700 text-sm font-medium mb-2"
                >Quantity *</label
              >
              <input
                type="number"
                id="product-quantity"
                min="0"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                required
              />
            </div>
            <div>
              <label
                for="product-price"
                class="block text-gray-700 text-sm font-medium mb-2"
                >Price ($) *</label
              >
              <input
                type="number"
                id="product-price"
                min="0"
                step="0.01"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                required
              />
            </div>
          </div>
          <div class="mb-4">
            <label
              for="product-description"
              class="block text-gray-700 text-sm font-medium mb-2"
              >Description</label
            >
            <textarea
              id="product-description"
              rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
            ></textarea>
          </div>
          <div class="flex justify-end space-x-3 pt-4">
            <button
              type="button"
              id="cancel-product"
              class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
            >
              Cancel
            </button>
            <button
              type="submit"
              id="save-product"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"
            >
              Save Product
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed bottom-4 right-4 z-50 hidden">
      <div
        class="notification bg-white rounded-lg shadow-lg p-4 max-w-xs border-l-4 border-green-500"
      >
        <div class="flex items-start">
          <div class="flex-shrink-0 text-green-500">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="ml-3">
            <p
              id="notification-message"
              class="text-sm font-medium text-gray-800"
            >
              Product added successfully!
            </p>
          </div>
          <button
            id="close-notification"
            class="ml-4 text-gray-400 hover:text-gray-500"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <script>
      // Sample product data
      let products = [
        {
          id: 1,
          name: "Wireless Headphones",
          category: "Electronics",
          quantity: 15,
          price: 99.99,
          description:
            "Noise-cancelling wireless headphones with 30hr battery life",
          image: "https://via.placeholder.com/80",
        },
        {
          id: 2,
          name: "Smartphone X",
          category: "Electronics",
          quantity: 8,
          price: 799.99,
          description: 'Latest flagship smartphone with 6.7" AMOLED display',
          image: "https://via.placeholder.com/80",
        },
        {
          id: 3,
          name: "Cotton T-Shirt",
          category: "Clothing",
          quantity: 42,
          price: 19.99,
          description: "100% cotton crew neck t-shirt in various colors",
          image: "https://via.placeholder.com/80",
        },
        {
          id: 4,
          name: "Coffee Maker",
          category: "Home & Garden",
          quantity: 5,
          price: 49.99,
          description: "12-cup programmable coffee maker",
          image: "https://via.placeholder.com/80",
        },
        {
          id: 5,
          name: "Organic Coffee Beans",
          category: "Food & Beverage",
          quantity: 3,
          price: 12.99,
          description: "1lb bag of organic fair trade coffee beans",
          image: "https://via.placeholder.com/80",
        },
        {
          id: 6,
          name: "JavaScript Cookbook",
          category: "Books",
          quantity: 11,
          price: 34.99,
          description: "Modern JavaScript recipes for developers",
          image: "https://via.placeholder.com/80",
        },
        {
          id: 7,
          name: "Bluetooth Speaker",
          category: "Electronics",
          quantity: 7,
          price: 59.99,
          description: "Portable waterproof speaker with 20hr battery",
          image: "https://via.placeholder.com/80",
        },
        {
          id: 8,
          name: "Yoga Mat",
          category: "Home & Garden",
          quantity: 23,
          price: 29.99,
          description: "Non-slip eco-friendly yoga mat",
          image: "https://via.placeholder.com/80",
        },
      ];

      // DOM Elements
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileSidebar = document.getElementById("mobile-sidebar");
      const navLinks = document.querySelectorAll(".nav-link");
      const navLinksMobile = document.querySelectorAll(".nav-link-mobile");
      const pageContents = document.querySelectorAll(".page-content");
      const addProductBtn = document.getElementById("add-product-btn");
      const addFirstProductBtn = document.getElementById(
        "add-first-product-btn"
      );
      const productModal = document.getElementById("product-modal");
      const closeModal = document.getElementById("close-modal");
      const cancelProduct = document.getElementById("cancel-product");
      const productForm = document.getElementById("product-form");
      const productsTableBody = document.getElementById("products-table-body");
      const productsCards = document.getElementById("products-cards");
      const noProductsMessage = document.getElementById("no-products-message");
      const searchProducts = document.getElementById("search-products");
      const categoryFilter = document.getElementById("category-filter");
      const notificationToast = document.getElementById("notification-toast");
      const closeNotification = document.getElementById("close-notification");
      const notificationBadge = document.getElementById("notification-badge");
      const notificationBtn = document.getElementById("notification-btn");
      const totalProductsElement = document.getElementById("total-products");
      const lowStockCountElement = document.getElementById("low-stock-count");
      const totalValueElement = document.getElementById("total-value");
      const topProductsBody = document.getElementById("top-products-body");
      const categoryReportBody = document.getElementById(
        "category-report-body"
      );
      const chartTypeSelect = document.getElementById("chart-type");
      const chartSortSelect = document.getElementById("chart-sort");
      const chartLegend = document.getElementById("chart-legend");

      // Chart instances
      let inventoryChart = null;
      let stockStatusChart = null;
      let categoryDistributionChart = null;

      // Current page state
      let currentPage = "dashboard";
      let editingProductId = null;

      // Initialize the app
      document.addEventListener("DOMContentLoaded", function () {
        updateDashboard();
        renderProductsTable();
        renderProductsCards();
        updateNotificationBadge();
        initCharts();

        // Set dashboard as active page
        setActivePage("dashboard");
      });

      // Mobile menu toggle
      mobileMenuButton.addEventListener("click", function () {
        const isOpen = mobileSidebar.classList.contains("translate-x-0");
        if (isOpen) {
          mobileSidebar.classList.remove("translate-x-0");
          mobileSidebar.classList.add("-translate-x-full");
        } else {
          mobileSidebar.classList.remove("-translate-x-full");
          mobileSidebar.classList.add("translate-x-0");
        }
      });

      // Navigation links
      navLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          const page = this.getAttribute("data-page");
          setActivePage(page);
          mobileSidebar.classList.remove("translate-x-0");
          mobileSidebar.classList.add("-translate-x-full");
        });
      });

      navLinksMobile.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          const page = this.getAttribute("data-page");
          setActivePage(page);
          mobileSidebar.classList.remove("translate-x-0");
          mobileSidebar.classList.add("-translate-x-full");
        });
      });

      // Chart type and sort change handlers
      chartTypeSelect.addEventListener("change", updateInventoryChart);
      chartSortSelect.addEventListener("change", updateInventoryChart);

      // Set active page
      function setActivePage(page) {
        currentPage = page;

        // Update page content visibility
        pageContents.forEach((content) => {
          content.classList.add("hidden");
          if (content.id === `${page}-page`) {
            content.classList.remove("hidden");
          }
        });

        // Update nav link active states
        navLinks.forEach((link) => {
          link.classList.remove("active");
          if (link.getAttribute("data-page") === page) {
            link.classList.add("active");
          }
        });

        navLinksMobile.forEach((link) => {
          link.classList.remove("active");
          if (link.getAttribute("data-page") === page) {
            link.classList.add("active");
          }
        });

        // Update specific page content if needed
        if (page === "dashboard") {
          updateDashboard();
        } else if (page === "reports") {
          updateReports();
        }
      }

      // Add product button
      addProductBtn.addEventListener("click", openAddProductModal);
      addFirstProductBtn.addEventListener("click", openAddProductModal);

      // Product modal
      function openAddProductModal() {
        editingProductId = null;
        document.getElementById("modal-title").textContent = "Add New Product";
        document.getElementById("product-id").value = "";
        document.getElementById("product-name").value = "";
        document.getElementById("product-category").value = "";
        document.getElementById("product-quantity").value = "";
        document.getElementById("product-price").value = "";
        document.getElementById("product-description").value = "";
        productModal.classList.remove("hidden");
      }

      function openEditProductModal(product) {
        editingProductId = product.id;
        document.getElementById("modal-title").textContent = "Edit Product";
        document.getElementById("product-id").value = product.id;
        document.getElementById("product-name").value = product.name;
        document.getElementById("product-category").value = product.category;
        document.getElementById("product-quantity").value = product.quantity;
        document.getElementById("product-price").value = product.price;
        document.getElementById("product-description").value =
          product.description || "";
        productModal.classList.remove("hidden");
      }

      closeModal.addEventListener("click", function () {
        productModal.classList.add("hidden");
      });

      cancelProduct.addEventListener("click", function () {
        productModal.classList.add("hidden");
      });

      // Product form submission
      productForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const productData = {
          id: editingProductId || Date.now(),
          name: document.getElementById("product-name").value,
          category: document.getElementById("product-category").value,
          quantity: parseInt(document.getElementById("product-quantity").value),
          price: parseFloat(document.getElementById("product-price").value),
          description: document.getElementById("product-description").value,
          image: "https://via.placeholder.com/80",
        };

        if (editingProductId) {
          // Update existing product
          const index = products.findIndex((p) => p.id === editingProductId);
          if (index !== -1) {
            products[index] = productData;
            showNotification("Product updated successfully!");
          }
        } else {
          // Add new product
          products.push(productData);
          showNotification("Product added successfully!");
        }

        // Update UI
        renderProductsTable();
        renderProductsCards();
        updateDashboard();
        productModal.classList.add("hidden");
      });

      // Delete product
      function deleteProduct(id) {
        if (confirm("Are you sure you want to delete this product?")) {
          products = products.filter((product) => product.id !== id);
          renderProductsTable();
          renderProductsCards();
          updateDashboard();
          showNotification("Product deleted successfully!");
        }
      }

      // Render products table
      function renderProductsTable() {
        const filteredProducts = filterProducts();

        if (filteredProducts.length === 0) {
          productsTableBody.innerHTML = "";
          noProductsMessage.classList.remove("hidden");
          return;
        }

        noProductsMessage.classList.add("hidden");

        let tableHTML = "";
        filteredProducts.forEach((product) => {
          const status = getStockStatus(product.quantity);
          const statusClass = `px-2 py-1 rounded-full text-xs font-medium ${status.class}`;

          tableHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <img src="${product.image}" alt="${
            product.name
          }" class="h-10 w-10 rounded">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${
                              product.name
                            }</div>
                            <div class="text-sm text-gray-500 truncate max-w-xs">${
                              product.description
                            }</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                          product.category
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                          product.quantity
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${product.price.toFixed(
                          2
                        )}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="${statusClass}">${status.text}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button onclick="openEditProductModal(${JSON.stringify(
                              product
                            ).replace(
                              /"/g,
                              "&quot;"
                            )})" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteProduct(${
                              product.id
                            })" class="text-red-600 hover:text-red-900">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
        });

        productsTableBody.innerHTML = tableHTML;
      }

      // Render products cards for mobile
      function renderProductsCards() {
        const filteredProducts = filterProducts();

        if (filteredProducts.length === 0) {
          productsCards.innerHTML = "";
          return;
        }

        let cardsHTML = "";
        filteredProducts.forEach((product) => {
          const status = getStockStatus(product.quantity);
          const statusClass = `px-2 py-1 rounded-full text-xs font-medium ${status.class}`;

          cardsHTML += `
                    <div class="product-card bg-white rounded-lg shadow p-4 transition duration-150 ease-in-out">
                        <div class="flex items-start space-x-4">
                            <img src="${product.image}" alt="${
            product.name
          }" class="h-16 w-16 rounded">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-sm font-medium text-gray-900 truncate">${
                                  product.name
                                }</h3>
                                <p class="text-xs text-gray-500">${
                                  product.category
                                }</p>
                                <div class="mt-1 flex items-center space-x-4">
                                    <span class="text-sm text-gray-500">Qty: ${
                                      product.quantity
                                    }</span>
                                    <span class="text-sm text-gray-500">$${product.price.toFixed(
                                      2
                                    )}</span>
                                    <span class="${statusClass}">${
            status.text
          }</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 flex justify-end space-x-2">
                            <button onclick="openEditProductModal(${JSON.stringify(
                              product
                            ).replace(
                              /"/g,
                              "&quot;"
                            )})" class="text-indigo-600 hover:text-indigo-900 text-sm">
                                <i class="fas fa-edit mr-1"></i> Edit
                            </button>
                            <button onclick="deleteProduct(${
                              product.id
                            })" class="text-red-600 hover:text-red-900 text-sm">
                                <i class="fas fa-trash mr-1"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
        });

        productsCards.innerHTML = cardsHTML;
      }

      // Filter products based on search and category
      function filterProducts() {
        const searchTerm = searchProducts.value.toLowerCase();
        const category = categoryFilter.value;

        return products.filter((product) => {
          const matchesSearch =
            product.name.toLowerCase().includes(searchTerm) ||
            product.description.toLowerCase().includes(searchTerm);
          const matchesCategory =
            category === "" || product.category === category;
          return matchesSearch && matchesCategory;
        });
      }

      // Search and filter events
      searchProducts.addEventListener("input", function () {
        renderProductsTable();
        renderProductsCards();
      });

      categoryFilter.addEventListener("change", function () {
        renderProductsTable();
        renderProductsCards();
      });

      // Get stock status
      function getStockStatus(quantity) {
        if (quantity === 0) {
          return { text: "Out of Stock", class: "status-out" };
        } else if (quantity < 5) {
          return { text: "Low Stock", class: "status-low" };
        } else {
          return { text: "In Stock", class: "status-in-stock" };
        }
      }

      // Update dashboard stats
      function updateDashboard() {
        const totalProducts = products.length;
        const lowStockProducts = products.filter(
          (p) => p.quantity > 0 && p.quantity < 5
        ).length;
        const totalInventoryValue = products.reduce(
          (sum, p) => sum + p.quantity * p.price,
          0
        );

        totalProductsElement.textContent = totalProducts;
        lowStockCountElement.textContent = lowStockProducts;
        totalValueElement.textContent = `$${totalInventoryValue.toFixed(2)}`;

        // Update top selling products (mock data)
        const topProducts = [...products]
          .sort(
            (a, b) =>
              b.price * (b.quantity < 5 ? 2 : 1) -
              a.price * (a.quantity < 5 ? 2 : 1)
          )
          .slice(0, 5);

        let topProductsHTML = "";
        topProducts.forEach((product) => {
          const sales = Math.floor(Math.random() * 50) + 10; // Mock sales data
          const revenue = sales * product.price;

          topProductsHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <img src="${product.image}" alt="${
            product.name
          }" class="h-10 w-10 rounded">
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${
                                      product.name
                                    }</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                          product.category
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sales}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${revenue.toFixed(
                          2
                        )}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                          product.quantity
                        }</td>
                    </tr>
                `;
        });

        topProductsBody.innerHTML = topProductsHTML;

        // Update inventory chart
        updateInventoryChart();
      }

      // Update inventory chart based on current settings
      function updateInventoryChart() {
        const chartType = chartTypeSelect.value;
        const sortBy = chartSortSelect.value;

        // Sort products based on selection
        let sortedProducts = [...products];
        if (sortBy === "name") {
          sortedProducts.sort((a, b) => a.name.localeCompare(b.name));
        } else if (sortBy === "quantity") {
          sortedProducts.sort((a, b) => b.quantity - a.quantity);
        } else if (sortBy === "value") {
          sortedProducts.sort(
            (a, b) => b.quantity * b.price - a.quantity * a.price
          );
        }

        // Limit to top 10 products for better visualization
        sortedProducts = sortedProducts.slice(0, 10);

        const labels = sortedProducts.map((p) => p.name);
        const quantities = sortedProducts.map((p) => p.quantity);
        const values = sortedProducts.map((p) => p.quantity * p.price);

        // Generate colors for the chart
        const backgroundColors = generateColors(sortedProducts.length);

        // Destroy existing chart if it exists
        if (inventoryChart) {
          inventoryChart.destroy();
        }

        const ctx = document.getElementById("inventory-chart").getContext("2d");

        if (chartType === "bar") {
          inventoryChart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: labels,
              datasets: [
                {
                  label:
                    sortBy === "value"
                      ? "Inventory Value ($)"
                      : "Quantity in Stock",
                  data: sortBy === "value" ? values : quantities,
                  backgroundColor: backgroundColors,
                  borderColor: backgroundColors.map((c) =>
                    c.replace("0.2", "1")
                  ),
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: sortBy === "value" ? "Value ($)" : "Quantity",
                  },
                },
                x: {
                  title: {
                    display: true,
                    text: "Products",
                  },
                },
              },
              plugins: {
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const product = sortedProducts[context.dataIndex];
                      if (sortBy === "value") {
                        return `$${product.price.toFixed(2)} × ${
                          product.quantity
                        } = $${(product.price * product.quantity).toFixed(2)}`;
                      } else {
                        return `${
                          product.quantity
                        } units ($${product.price.toFixed(2)} each)`;
                      }
                    },
                  },
                },
                legend: {
                  display: false,
                },
              },
            },
          });
        } else if (chartType === "pie") {
          inventoryChart = new Chart(ctx, {
            type: "pie",
            data: {
              labels: labels,
              datasets: [
                {
                  data: sortBy === "value" ? values : quantities,
                  backgroundColor: backgroundColors,
                  borderColor: "#fff",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const product = sortedProducts[context.dataIndex];
                      const label = context.label || "";
                      const value = context.raw || 0;
                      const percentage =
                        context.dataset.data.reduce((a, b) => a + b, 0) > 0
                          ? Math.round(
                              (value /
                                context.dataset.data.reduce(
                                  (a, b) => a + b,
                                  0
                                )) *
                                100
                            )
                          : 0;

                      if (sortBy === "value") {
                        return `${label}: $${value.toFixed(
                          2
                        )} (${percentage}%)`;
                      } else {
                        return `${label}: ${value} units (${percentage}%)`;
                      }
                    },
                  },
                },
                legend: {
                  position: "right",
                },
              },
            },
          });
        } else if (chartType === "line") {
          inventoryChart = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label:
                    sortBy === "value"
                      ? "Inventory Value ($)"
                      : "Quantity in Stock",
                  data: sortBy === "value" ? values : quantities,
                  backgroundColor: backgroundColors[0],
                  borderColor: backgroundColors[0].replace("0.2", "1"),
                  borderWidth: 2,
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: sortBy === "value" ? "Value ($)" : "Quantity",
                  },
                },
                x: {
                  title: {
                    display: true,
                    text: "Products",
                  },
                },
              },
              plugins: {
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const product = sortedProducts[context.dataIndex];
                      if (sortBy === "value") {
                        return `$${product.price.toFixed(2)} × ${
                          product.quantity
                        } = $${(product.price * product.quantity).toFixed(2)}`;
                      } else {
                        return `${
                          product.quantity
                        } units ($${product.price.toFixed(2)} each)`;
                      }
                    },
                  },
                },
              },
            },
          });
        }

        // Update legend
        updateChartLegend(sortedProducts, sortBy);
      }

      // Generate colors for the chart
      function generateColors(count) {
        const colors = [];
        const hueStep = 360 / count;

        for (let i = 0; i < count; i++) {
          const hue = i * hueStep;
          colors.push(`hsla(${hue}, 70%, 60%, 0.7)`);
        }

        return colors;
      }

      // Update chart legend
      function updateChartLegend(products, sortBy) {
        let legendHTML = "";

        products.forEach((product, index) => {
          const value =
            sortBy === "value"
              ? product.quantity * product.price
              : product.quantity;
          const displayValue =
            sortBy === "value" ? `$${value.toFixed(2)}` : value;

          legendHTML += `
                    <div class="legend-item" onclick="highlightChartItem(${index})">
                        <div class="legend-color" style="background-color: hsla(${
                          index * (360 / products.length)
                        }, 70%, 60%, 0.7)"></div>
                        <div class="legend-text">
                            ${product.name}: ${displayValue}
                        </div>
                    </div>
                `;
        });

        chartLegend.innerHTML = legendHTML;
      }

      // Highlight chart item when legend is clicked
      function highlightChartItem(index) {
        if (inventoryChart) {
          // Get the chart type
          const chartType = inventoryChart.config.type;

          if (chartType === "pie" || chartType === "doughnut") {
            // For pie/doughnut charts, highlight the segment
            const meta = inventoryChart.getDatasetMeta(0);
            meta.data[index].transition({ duration: 0 }).outerRadius += 10;
            inventoryChart.update();

            // Reset after animation
            setTimeout(() => {
              meta.data[index].transition({ duration: 500 }).outerRadius -= 10;
              inventoryChart.update();
            }, 500);
          } else {
            // For bar/line charts, highlight the bar/point
            const meta = inventoryChart.getDatasetMeta(0);
            const element = meta.data[index];

            // Animate the element
            inventoryChart.setActiveElements([{ datasetIndex: 0, index }]);
            inventoryChart.update();
          }
        }
      }

      // Update reports
      function updateReports() {
        // Category distribution data for chart
        const categories = [...new Set(products.map((p) => p.category))];
        const categoryCounts = categories.map(
          (cat) => products.filter((p) => p.category === cat).length
        );

        // Stock status data for chart
        const inStock = products.filter((p) => p.quantity >= 5).length;
        const lowStock = products.filter(
          (p) => p.quantity > 0 && p.quantity < 5
        ).length;
        const outOfStock = products.filter((p) => p.quantity === 0).length;

        // Category report data for table
        let categoryReportHTML = "";
        categories.forEach((category) => {
          const categoryProducts = products.filter(
            (p) => p.category === category
          );
          const totalQuantity = categoryProducts.reduce(
            (sum, p) => sum + p.quantity,
            0
          );
          const totalValue = categoryProducts.reduce(
            (sum, p) => sum + p.quantity * p.price,
            0
          );

          categoryReportHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${category}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                          categoryProducts.length
                        }</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${totalQuantity}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${totalValue.toFixed(
                          2
                        )}</td>
                    </tr>
                `;
        });

        categoryReportBody.innerHTML = categoryReportHTML;

        // Update charts
        updateStockStatusChart(inStock, lowStock, outOfStock);
        updateCategoryDistributionChart(categories, categoryCounts);
      }

      // Initialize charts
      function initCharts() {
        // Stock status chart (reports)
        const stockStatusCtx = document
          .getElementById("stock-status-chart")
          .getContext("2d");
        stockStatusChart = new Chart(stockStatusCtx, {
          type: "doughnut",
          data: {
            labels: ["In Stock", "Low Stock", "Out of Stock"],
            datasets: [
              {
                data: [0, 0, 0], // Will be updated
                backgroundColor: ["#10B981", "#F59E0B", "#EF4444"],
              },
            ],
          },
        });

        // Category distribution chart (reports)
        const categoryCtx = document
          .getElementById("category-distribution-chart")
          .getContext("2d");
        categoryDistributionChart = new Chart(categoryCtx, {
          type: "pie",
          data: {
            labels: [], // Will be updated
            datasets: [
              {
                data: [], // Will be updated
                backgroundColor: [
                  "#6366F1",
                  "#EC4899",
                  "#10B981",
                  "#F59E0B",
                  "#EF4444",
                  "#8B5CF6",
                ],
              },
            ],
          },
        });
      }

      // Update stock status chart
      function updateStockStatusChart(inStock, lowStock, outOfStock) {
        if (stockStatusChart) {
          stockStatusChart.data.datasets[0].data = [
            inStock,
            lowStock,
            outOfStock,
          ];
          stockStatusChart.update();
        }
      }

      // Update category distribution chart
      function updateCategoryDistributionChart(categories, counts) {
        if (categoryDistributionChart) {
          categoryDistributionChart.data.labels = categories;
          categoryDistributionChart.data.datasets[0].data = counts;
          categoryDistributionChart.update();
        }
      }

      // Show notification
      function showNotification(message) {
        const notification = document.getElementById("notification-message");
        notification.textContent = message;
        notificationToast.classList.remove("hidden");

        // Auto-hide after 3 seconds
        setTimeout(() => {
          notificationToast.classList.add("hidden");
        }, 3000);

        updateNotificationBadge();
      }

      // Close notification
      closeNotification.addEventListener("click", function () {
        notificationToast.classList.add("hidden");
      });

      // Update notification badge
      function updateNotificationBadge() {
        const lowStockCount = products.filter(
          (p) => p.quantity > 0 && p.quantity < 5
        ).length;
        if (lowStockCount > 0) {
          notificationBadge.textContent = lowStockCount;
          notificationBadge.classList.remove("hidden");
        } else {
          notificationBadge.classList.add("hidden");
        }
      }

      // Notification button
      notificationBtn.addEventListener("click", function () {
        const lowStockProducts = products.filter(
          (p) => p.quantity > 0 && p.quantity < 5
        );
        if (lowStockProducts.length > 0) {
          let alertMessage = "Low stock alert for:\n";
          lowStockProducts.forEach((p) => {
            alertMessage += `- ${p.name} (${p.quantity} left)\n`;
          });
          alert(alertMessage);
        } else {
          alert("No low stock alerts at this time.");
        }
      });

      // Make functions available globally for inline event handlers
      window.openEditProductModal = openEditProductModal;
      window.deleteProduct = deleteProduct;
      window.highlightChartItem = highlightChartItem;
    </script>
  </body>
</html>
